language: c

sudo: false

before_install:
  - if [ ! -d $HOME/build/git ]; then git clone ./ $HOME/build/git; fi
  - pushd $HOME/build/git
  - git fetch origin && git reset --hard origin/${TRAVIS_BRANCH}
  - for FILE in $(git ls-files); do \
      TIME=$(git log --pretty=format:%cd -n 1 --date=iso $FILE); \
      TIME=$(date -j -f '%Y-%m-%d %H:%M:%S %z' "$TIME" +%Y%m%d%H%M.%S); \
      touch -m -t $TIME $FILE; \
    done

install:
  - make -j4

script:
  - cd t/
  - prove --timer -j8 ./t[0-9]*.sh

cache:
  directories:
    - $HOME/build/git

